{"version":3,"file":"Legend-08cf2f79.js","sources":["../../../home/runner/work/metastanza/metastanza/lib/Legend.js"],"sourcesContent":["import { LitElement, html } from \"lit-element\";\n\nexport default class Legend extends LitElement {\n  constructor() {\n    super();\n    this.items = [];\n  }\n\n  static get properties() {\n    return {\n      items: { type: Array },\n    };\n  }\n\n  render() {\n    return html`\n      <style>\n        .origin {\n          position: absolute;\n          top: 0;\n          left: 0;\n        }\n        .legend {\n          padding: 3px 9px;\n          position: absolute;\n          font-size: 10px;\n          line-height: 1.5;\n          max-height: 100%;\n          overflow-y: auto;\n          color: var(--togostanza-label-font-color);\n          background-color: rgba(255, 255, 255, 0.8);\n          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);\n          white-space: nowrap;\n        }\n        .legend > table > tbody > tr > td > .marker {\n          display: inline-block;\n          width: 1em;\n          height: 1em;\n          border-radius: 100%;\n          vertical-align: middle;\n          margin-right: 0.3em;\n        }\n        .legend > table > tbody > tr > td.number {\n          text-align: right;\n        }\n        .leader {\n          position: absolute;\n          border-left: dotted 1px black;\n          z-index: 10000;\n          opacity: 0;\n          pointer-events: none;\n          transition: all 0.2s;\n        }\n        .leader[data-direction=\"top\"] {\n          border-top: dotted 1px black;\n        }\n        .leader[data-direction=\"bottom\"] {\n          border-bottom: dotted 1px black;\n        }\n        .leader.-show {\n          opacity: 0.5;\n        }\n      </style>\n      <div class=\"origin\"></div>\n      <div class=\"legend\">\n        <table>\n          <tbody>\n            ${this.items.map((item) => {\n              return html` <tr data-id=\"${item.id}\">\n                <td>\n                  <span\n                    class=\"marker\"\n                    style=\"background-color: ${item.color}\"\n                  ></span\n                  >${item.label}\n                </td>\n                ${item.value\n                  ? html`<td class=\"${(typeof item.value).toLowerCase()}\">\n                      ${item.value}\n                    </td>`\n                  : \"\"}\n              </tr>`;\n            })}\n          </tbody>\n        </table>\n      </div>\n      <div class=\"leader\"></div>\n    `;\n  }\n  /**\n   *\n   * @param {Object[]} items\n   * @param {string?} items[].id\n   * @param {label} items[].label\n   * @param {string} items[].color\n   * @param {number?} items[].value\n   * @param {HTMLElement?} items[].node\n   * @param {Node} container\n   * @param {Object} opt\n   * @param {NodeList?} opt.fadeoutNodes\n   * @param {string?} opt.fadeProp\n   */\n  setup(items, container, opt) {\n    console.log(container)\n    this.items = items;\n\n    this.render();\n\n    const positions = opt.position || [\"top\", \"right\"];\n\n    //  name of style property to fadeout. for fill - \"opacity\", for path's stroke - \"stroke-opacity\" etc.\n    const fadeProp = opt.fadeProp || \"opacity\";\n\n    // show/not show leaders\n    const showLeaders = opt.showLeaders;\n    // placement\n    const legend = this.shadowRoot.querySelector(\".legend\");\n\n    [\"top\", \"bottom\", \"left\", \"right\"].forEach((pos) => {\n      legend.style[pos] = \"\";\n    });\n\n    positions.forEach((position) => {\n      legend.style[position] = 0;\n    });\n\n    if (!opt.fadeoutNodes) {\n      return;\n    }\n\n    const leader = this.shadowRoot.querySelector(\".leader\");\n\n    // event\n    window.requestAnimationFrame(() => {\n      this.shadowRoot\n        .querySelectorAll(\".legend > table > tbody > tr\")\n        .forEach((tr) => {\n          tr.addEventListener(\"mouseover\", () => {\n            const datum = items.find((item) => item.id === tr.dataset.id);\n            if (!datum.node) {\n              return;\n            }\n            if (datum) {\n              opt.fadeoutNodes.forEach((node) => {\n                node.style[fadeProp] = 0.2;\n              });\n\n              if (Array.isArray(datum.node) && datum.node.length !== 0) {\n                datum.node.forEach((item) => (item.style[fadeProp] = \"\"));\n              } else if (!Array.isArray(datum.node)) {\n                datum.node.style[fadeProp] = \"\";\n              } else {\n                return;\n              }\n\n              if (showLeaders) {\n                leader.classList.add(\"-show\");\n                const originRect = this.shadowRoot\n                  .querySelector(\".origin\")\n                  .getBoundingClientRect();\n                const legendRect = tr.getBoundingClientRect();\n                const targetRect = datum.node.getBoundingClientRect();\n                leader.style.left =\n                  targetRect.x + targetRect.width * 0.5 - originRect.x + \"px\";\n                leader.style.width =\n                  legendRect.x -\n                  targetRect.right +\n                  targetRect.width * 0.5 +\n                  \"px\";\n                const legendMiddle = legendRect.y + legendRect.height * 0.5;\n                const targetMiddle = targetRect.y + targetRect.height * 0.5;\n                if (legendMiddle < targetMiddle) {\n                  leader.dataset.direction = \"top\";\n                  leader.style.top = legendMiddle - originRect.y + \"px\";\n                  leader.style.height = targetMiddle - legendMiddle + \"px\";\n                } else {\n                  leader.dataset.direction = \"bottom\";\n                  leader.style.top = targetMiddle - originRect.y + \"px\";\n                  leader.style.height = legendMiddle - targetMiddle + \"px\";\n                }\n              }\n            }\n          });\n          tr.addEventListener(\"mouseleave\", () => {\n            opt.fadeoutNodes.forEach((node) => {\n              node.style[fadeProp] = \"\";\n            });\n            leader.classList.remove(\"-show\");\n          });\n        });\n    });\n  }\n}\n\ncustomElements.define(\"togostanza--legend\", Legend);\n"],"names":["LitElement","html"],"mappings":"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"}