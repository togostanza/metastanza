{"version":3,"file":"tree.js","sources":["../../../home/runner/work/metastanza/metastanza/stanzas/tree/index.js"],"sourcesContent":["import vegaEmbed from \"vega-embed\";\n\nexport default async function tree(stanza, params) {\n  const spec = await fetch(params[\"src-url\"]).then((res) => res.json());\n\n  //width、height、padding\n  spec.width = params[\"width\"];\n  spec.height = params[\"height\"];\n  spec.padding = params[\"padding\"];\n\n  //delete default controller\n  for (const signal of spec.signals) {\n    delete signal.bind;\n  }\n\n  //data\n  const labelVariable = params[\"label-variable\"]; //\"name\"\n  const parentVariable = params[\"parent-variable\"]; //\"parent\"\n  const idVariable = params[\"id-variable\"]; //\"id-variable\"\n\n  spec.data = [\n    {\n      name: \"tree\",\n      url: params[\"your-data\"],\n      transform: [\n        {\n          type: \"stratify\",\n          key: idVariable,\n          parentKey: parentVariable,\n        },\n        {\n          type: \"tree\",\n          method: { signal: \"layout\" },\n          size: [{ signal: \"height\" }, { signal: \"width - 100\" }],\n          separation: { signal: \"separation\" },\n          as: [\"y\", \"x\", \"depth\", \"children\"],\n        },\n      ],\n    },\n    {\n      name: \"links\",\n      source: \"tree\",\n      transform: [\n        { type: \"treelinks\" },\n        {\n          type: \"linkpath\",\n          orient: \"horizontal\",\n          shape: { signal: \"links\" },\n        },\n      ],\n    },\n  ];\n\n  //scales\n  spec.scales = [\n    {\n      name: \"color\",\n      type: \"ordinal\",\n      range: [\n        \"var(--series-0-color)\",\n        \"var(--series-1-color)\",\n        \"var(--series-2-color)\",\n        \"var(--series-3-color)\",\n        \"var(--series-4-color)\",\n        \"var(--series-5-color)\",\n      ],\n      domain: { data: \"tree\", field: \"depth\" },\n      zero: true,\n    },\n  ];\n\n  //legend\n  spec.legends = [\n    {\n      fill: \"color\",\n      title: params[\"legend-title\"],\n      titleColor: \"var(--legendtitle-color)\",\n      labelColor: \"var(--legendlabel-color)\",\n      orient: \"top-left\",\n      encode: {\n        title: {\n          update: {\n            font: {\n              value: getComputedStyle(stanza.root.host).getPropertyValue(\n                \"--legend-font\"\n              ),\n            },\n            fontSize: {\n              value: getComputedStyle(stanza.root.host).getPropertyValue(\n                \"--legendtitle-size\"\n              ),\n            },\n            fontWeight: {\n              value: getComputedStyle(stanza.root.host).getPropertyValue(\n                \"--legendtitle-weight\"\n              ),\n            },\n          },\n        },\n        labels: {\n          interactive: true,\n          update: {\n            font: {\n              value: getComputedStyle(stanza.root.host).getPropertyValue(\n                \"--legend-font\"\n              ),\n            },\n            fontSize: {\n              value: getComputedStyle(stanza.root.host).getPropertyValue(\n                \"--legendlabel-size\"\n              ),\n            },\n          },\n          text: { field: \"value\" },\n        },\n        symbols: {\n          update: {\n            shape: { value: params[\"symbol-shape\"] },\n            stroke: { value: \"var(--stroke-color)\" },\n            strokeWidth: {\n              value: getComputedStyle(stanza.root.host).getPropertyValue(\n                \"--stroke-width\"\n              ),\n            },\n            opacity: {\n              value: getComputedStyle(stanza.root.host).getPropertyValue(\n                \"--opacity\"\n              ),\n            },\n          },\n        },\n      },\n    },\n  ];\n\n  //marks\n  spec.marks = [\n    {\n      type: \"path\",\n      from: { data: \"links\" },\n      encode: {\n        update: {\n          path: { field: \"path\" },\n          stroke: { value: \"var(--branch-color)\" },\n        },\n        hover: {\n          stroke: { value: \"var(--emphasized-color)\" },\n        },\n      },\n    },\n    {\n      type: \"symbol\",\n      from: { data: \"tree\" },\n      encode: {\n        enter: {\n          size: {\n            value: getComputedStyle(stanza.root.host).getPropertyValue(\n              \"--node-size\"\n            ),\n          },\n          stroke: { value: \"var(--stroke-color)\" },\n        },\n        update: {\n          x: { field: \"x\" },\n          y: { field: \"y\" },\n          fill: { scale: \"color\", field: \"depth\" },\n          stroke: { value: \"var(--stroke-color)\" },\n          strokeWidth: {\n            value: getComputedStyle(stanza.root.host).getPropertyValue(\n              \"--stroke-width\"\n            ),\n          },\n        },\n        hover: {\n          fill: { value: \"var(--emphasized-color)\" },\n          stroke: { value: \"var(--hover-stroke-color)\" },\n          strokeWidth: {\n            value: getComputedStyle(stanza.root.host).getPropertyValue(\n              \"--hover-stroke-width\"\n            ),\n          },\n        },\n      },\n    },\n    {\n      type: \"text\",\n      from: { data: \"tree\" },\n      encode: {\n        enter: {\n          text: { field: labelVariable },\n          font: {\n            value: getComputedStyle(stanza.root.host).getPropertyValue(\n              \"--font-family\"\n            ),\n          },\n          fontSize: {\n            value: getComputedStyle(stanza.root.host).getPropertyValue(\n              \"--label-size\"\n            ),\n          },\n          baseline: { value: \"middle\" },\n        },\n        update: {\n          x: { field: \"x\" },\n          y: { field: \"y\" },\n          dx: { signal: \"datum.children ? -7 : 7\" },\n          align: { signal: \"datum.children ? 'right' : 'left'\" },\n          opacity: { signal: \"labels ? 1 : 0\" },\n          fill: { value: \"var(--label-color)\" },\n          // strokeWidth: {\n          //   value: getComputedStyle(stanza.root.host).getPropertyValue(\n          //     \"--stroke-width\"\n          //   ),\n          // },\n        },\n        hover: {\n          fill: { value: \"var(--emphasized-color)\" },\n          stroke: { value: \"var(--hover-stroke-color)\" },\n          strokeWidth: { value: \"0.5\" },\n        },\n      },\n    },\n  ];\n\n  const el = stanza.root.querySelector(\"main\");\n  const opts = {\n    renderer: \"svg\",\n  };\n  await vegaEmbed(el, spec, opts);\n}\n"],"names":["vegaEmbed"],"mappings":"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"}