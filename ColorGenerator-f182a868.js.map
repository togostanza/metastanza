{"version":3,"file":"ColorGenerator-f182a868.js","sources":["../../../home/runner/work/metastanza/metastanza/lib/ColorGenerator.js"],"sourcesContent":["import * as d3 from \"d3\";\n\n//Convert domain values between 0 and 1\nconst clamp = (num) => Math.min(Math.max(num, 0), 1);\n\n//Parent class\nclass ColorGenerator {\n  /**\n   * @param {array} range - Params \"color-range\"\n   * @param {array} domain - Params \"color-domain\"\n   * @return {function} - Color generation function\n   */\n  constructor(range, domain) {\n    this.colors = range;\n    if (domain) {\n      domain = domain.map((num) => clamp(num));\n    }\n  }\n\n  // get length() {\n  //   return this.colors.length;\n  // }\n}\n\n//When params \"type-of-color-circulation\" is \"circulate\"\nexport class CirculateColorGenerator extends ColorGenerator {\n  /**\n   * @param {number} numberOfMakeColor - Params \"number-of-make-color\"\n   */\n  constructor(range, domain, numberOfMakeColor) {\n    super(range, domain);\n\n    //Set the color scale with reference to the value of \"domain\" and the color of \"range\"\n    if (domain) {\n      //Create colors for params\"number-of-make-color\" values by params \"color-range\" \"color-domain values\"\n      this.colorScale = d3.scaleLinear().domain(domain).range(this.colors);\n      this.colors = [...Array(numberOfMakeColor)].map((_, index) => {\n        return this.colorScale(index / (numberOfMakeColor - 1));\n      });\n    } else {\n      //Repeat the color of params \"color-range\"\n      this.colorScale = d3.scaleOrdinal().range(this.colors);\n    }\n  }\n\n  //Get each index number for repeated drawings\n  get(index) {\n    return this.colors[index % this.colors.length];\n  }\n\n  //Get data and assign id\n  // getById(data, id) {\n  //   const uniqueData = Array.from(new Set(data));\n  //   const colorMap = new Map();\n  //   uniqueData.forEach((element, index) => {\n  //     colorMap.set(element, this.colors[index % this.colors.length]);\n  //   });\n  //   return colorMap.get(id);\n  // }\n}\n\n//When params \"type-of-color-circulation\" is \"interpolate\"\nexport class InterpolateColorGenerator extends ColorGenerator {\n  constructor(range, domain) {\n    super(range, domain);\n\n    //Set the color scale with reference to the value of \"domain\" and the color of \"range\"\n    const unit = 1 / (this.colors.length - 1);\n    this.colorScale = d3\n      .scaleLinear()\n      .domain(\n        domain ?? [...Array(this.colors.length)].map((_, index) => index * unit)\n      )\n      .range(this.colors);\n  }\n\n  //Get color for each position\n  get(position) {\n    return this.colorScale(position);\n  }\n}\n\n//Parent class for stanza\nexport class StanzaColorGenerator {\n  /**\n   * @param {HTMLElement} self - Information of the stanza\n   * @return {object}  - Colors based on \"togostanza them\"\n   */\n  constructor(self) {\n    this.self = self;\n  }\n\n  //Create object of colors based on \"togostanza-theme-series\"\n  static getColorSeries(stanza) {\n    const getPropertyValue = (key) =>\n      window.getComputedStyle(stanza.element).getPropertyValue(key);\n    const series = [];\n    let index = 0;\n    let color = getPropertyValue(`--togostanza-theme-series_${index}_color`);\n    while (color) {\n      series.push(color.trim());\n      color = getPropertyValue(`--togostanza-theme-series_${++index}_color`);\n    }\n    return { stanzaColors: series, firstColor: series[0] };\n  }\n\n  //Get stanzaColor\n  get stanzaColor() {\n    const stanza = this.self;\n    return StanzaColorGenerator.getColorSeries(stanza).stanzaColors;\n  }\n}\n\n//CirculateColorGenerator class for stanza\nexport class StanzaCirculateColorGenerator extends StanzaColorGenerator {\n  /**\n   * @param {array} data - Array of data\n   * @param {array} colorGroup - Array of specified color group\n   */\n  constructor(self, data, colorGroup) {\n    super(self);\n    const stanza = this.self;\n    const stanzaColor = StanzaColorGenerator.getColorSeries(stanza);\n    const colorRange = stanzaColor.stanzaColors.slice(1, 6);\n    this.firstColor = stanzaColor.firstColor;\n\n    //Create array for domain and define color scale\n    const groups = Array.from(\n      new Set(data.flatMap((d) => d[colorGroup])).delete(undefined)\n    );\n    this.groupColor = d3.scaleOrdinal().domain(groups).range(colorRange);\n  }\n\n  get defaultColor() {\n    return this.firstColor;\n  }\n\n  getColor(datum) {\n    return this.groupColor(datum);\n  }\n}\n\n//Generate color scheme for gradation pattern\nexport function getGradationColor(self, colorRange, colorDomain) {\n  /**\n   * @param {HTMLElement} self - Information of the stanza\n   * @param {array} colorRange - [minColor, midColor, maxColor]\n   * @param {array} colorDomain - [minNumber, midNumber, maxNumber]\n   */\n\n  colorRange = colorRange.filter(Boolean);\n  let colors = colorRange;\n  let domain = colorDomain;\n\n  if (colorRange.length === 1 || colorRange.length === 0) {\n    colors = StanzaColorGenerator.getColorSeries(self).stanzaColors;\n\n    const delta = (colorDomain[2] - colorDomain[0]) / (colors.length - 1);\n    domain = [...Array(colors.length)].map(\n      (_, index) => colorDomain[0] + index * delta\n    );\n  }\n\n  return d3.scaleLinear().domain(domain).range(colors).clamp(true);\n}\n\n//Generate color scheme for StanzaInterpolateColor pattern\nexport function getStanzaInterpolateColor(self, colorNum) {\n  /**\n   * @param {HTMLElement} self - Information of the stanza\n   * @param {number} colorNum - Number of colors\n   */\n\n  const stazaColors = StanzaColorGenerator.getColorSeries(self).stanzaColors;\n  const domains = [];\n  for (let i = 0; i < stazaColors.length; i++) {\n    domains.push((colorNum / stazaColors.length) * i);\n  }\n\n  return d3.scaleLinear().domain(domains).range(stazaColors);\n}\n"],"names":["d3.scaleLinear","d3.scaleOrdinal","d3\n      .scaleLinear"],"mappings":"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"}