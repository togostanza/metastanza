{"version":3,"file":"load-data-ad9ea040.js","sources":["../../../home/runner/work/metastanza/metastanza/node_modules/togostanza-utils/load-data.js"],"sourcesContent":["import * as d3 from \"d3\";\n\nlet style;\n\nexport function showLoadingIcon(element) {\n  if (element.offsetHeight < 30) {\n    d3.select(element).transition().duration(100).style(\"min-height\", \"30px\");\n  }\n\n  const css = (key) => getComputedStyle(element).getPropertyValue(key);\n\n  const spinnerColor = css(\"--togostanza-loading-spinner-color\");\n\n  const main = d3.select(element).classed(\"main-center\", true);\n\n  style = document.createElement(\"style\");\n  style.setAttribute(\"id\", \"spinner-css\");\n\n  style.innerHTML = getSpinnerCss(spinnerColor || \"grey\");\n  element.getRootNode().appendChild(style);\n\n  const container = d3\n    .select(element)\n    .append(\"div\")\n    .attr(\"class\", \"metastanza-loading-icon-div\")\n    .attr(\"id\", \"metastanza-loading-icon-div\");\n\n  container.append(\"div\").classed(\"loading\", true);\n  container.append(\"div\").classed(\"circle\", true);\n}\n\nexport function hideLoadingIcon(element) {\n  style?.remove();\n  d3.select(element).select(\"#metastanza-loading-icon-div\").remove();\n}\n\nfunction displayApiError(element, error) {\n  d3.select(element).select(\".metastanza-error-message-div\").remove();\n  const p = d3\n    .select(element)\n    .append(\"div\")\n    .attr(\"class\", \"metastanza-error-message-div\")\n    .append(\"p\")\n    .attr(\"class\", \"metastanza-error-message\");\n  p.append(\"span\").text(\"MetaStanza API error\");\n  p.append(\"br\");\n  p.append(\"span\").text(error);\n}\n\nasync function loadJSON(url, requestInit) {\n  const res = await fetch(url, requestInit);\n  return await res.json();\n}\n\nfunction sparql2table(json) {\n  const head = json.head.vars;\n  const data = json.results.bindings;\n\n  return data.map((item) => {\n    const row = {};\n    head.forEach((key) => {\n      row[key] = item[key] ? item[key].value : \"\";\n    });\n    return row;\n  });\n}\n\nasync function loadSPARQL(url, requestInit) {\n  const requestInitWithHeader = {\n    headers: {\n      Accept: \"application/sparql-results+json\",\n    },\n    ...requestInit,\n  };\n\n  const json = await loadJSON(url, requestInitWithHeader);\n  return sparql2table(json);\n}\n\nfunction getLoader(type) {\n  switch (type) {\n    case \"tsv\":\n      return d3.tsv;\n    case \"csv\":\n      return d3.csv;\n    case \"sparql-results-json\":\n      return loadSPARQL;\n    case \"json\":\n    default:\n      return loadJSON;\n  }\n}\n\nlet cache = null;\nlet cacheKey = null;\n\nexport default async function loadData(\n  url,\n  type = \"json\",\n  mainElement = null,\n  timeout = 10 * 60 * 1000\n) {\n  const _cacheKey = JSON.stringify({ url, type });\n  if (cacheKey === _cacheKey) {\n    return cache;\n  }\n\n  const loader = getLoader(type);\n  let data = null;\n\n  const controller = new AbortController();\n  const requestInit = {\n    signal: controller.signal,\n  };\n\n  const timer = setTimeout(() => {\n    controller.abort();\n  }, timeout);\n\n  try {\n    if (mainElement) {\n      showLoadingIcon(mainElement);\n    }\n    data = await loader(url, requestInit);\n\n    cache = data;\n    cacheKey = _cacheKey;\n  } catch (error) {\n    if (mainElement) {\n      const detail =\n        error.name === \"AbortError\"\n          ? \"Error: Request timed out.\"\n          : error.toString();\n\n      displayApiError(mainElement, detail);\n    }\n\n    throw error;\n  } finally {\n    if (mainElement) {\n      hideLoadingIcon(mainElement);\n    }\n    clearTimeout(timer);\n  }\n\n  return data;\n}\n\nfunction getSpinnerCss(color) {\n  return `\n  :host {\n    --loading_spinner_background: ${color};\n    --dot_1: rgba(255,255,255,1);\n    --dot_2: rgba(255,255,255,0.8);\n    --dot_3: rgba(255,255,255,0.6);\n    --dot_4: rgba(255,255,255,0.3);\n  }\n\n  .main-center {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    height: 150px;\n  }\n\n  .metastanza-loading-icon-div {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    height: 150px;\n    position: relative;\n  }\n\n  .circle {\n    width: 35px;\n    height: 35px;\n    border-radius: 50%;\n    background-color: var(--loading_spinner_background);\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n  }\n\n  .loading {\n    height: 3.5px;\n    width: 3.5px;\n    border-radius: 50%;\n    animation: load 1.5s infinite ease;\n    z-index: 1;\n  }\n\n  @keyframes load {\n    0%,\n    100% {\n      box-shadow: 0em -0.7em 0em 0em var(--dot_1), 0.5em -0.45em 0 0em var(--dot_4), 0.7em 0em 0 0em var(--dot_4),\n        0.45em 0.4em 0 0em var(--dot_4), 0em 0.7em 0 0em var(--dot_4),\n        -0.45em 0.45em 0 0em var(--dot_3),-0.7em 0em 0 0em var(--dot_4),\n        -0.45em -0.45em 0 0em var(--dot_2);\n    }\n    12.5% {\n      box-shadow: 0em -0.7em 0em 0em var(--dot_2), 0.5em -0.45em 0 0em var(--dot_1), 0.7em 0em 0 0em var(--dot_4),\n        0.45em 0.4em 0 0em var(--dot_4), 0em 0.7em 0 0em var(--dot_4),\n        -0.45em 0.45em 0 0em var(--dot_4),-0.7em 0em 0 0em var(--dot_4),\n        -0.45em -0.45em 0 0em var(--dot_3);\n    }\n    25% {\n      box-shadow: 0em -0.7em 0em 0em var(--dot_3), 0.5em -0.45em 0 0em var(--dot_2), 0.7em 0em 0 0em var(--dot_1),\n        0.5em 0.45em 0 0em var(--dot_4), 0em 0.7em 0 0em var(--dot_4),\n        -0.5em 0.45em 0 0em var(--dot_4),-0.7em 0em 0 0em var(--dot_4),\n        -0.5em -0.45em 0 0em var(--dot_4);\n    }\n    37.5% {\n      box-shadow: 0em -0.7em 0em 0em var(--dot_4), 0.5em -0.45em 0 0em var(--dot_3), 0.7em 0em 0 0em var(--dot_2),\n        0.5em 0.45em 0 0em var(--dot_1), 0em 0.7em 0 0em var(--dot_4),\n        -0.5em 0.45em 0 0em var(--dot_4),-0.7em 0em 0 0em var(--dot_4),\n        -0.5em -0.45em 0 0em var(--dot_4);\n    }\n    50% {\n      box-shadow: 0em -0.7em 0em 0em var(--dot_4), 0.5em -0.45em 0 0em var(--dot_4), 0.7em 0em 0 0em var(--dot_3),\n        0.5em 0.45em 0 0em var(--dot_2), 0em 0.7em 0 0em var(--dot_1),\n        -0.5em 0.45em 0 0em var(--dot_4),-0.7em 0em 0 0em var(--dot_4),\n        -0.5em -0.45em 0 0em var(--dot_4);\n    }\n    62.5% {\n      box-shadow: 0em -0.7em 0em 0em var(--dot_4), 0.5em -0.45em 0 0em var(--dot_4), 0.7em 0em 0 0em var(--dot_4),\n        0.5em 0.45em 0 0em var(--dot_3), 0em 0.7em 0 0em var(--dot_2),\n        -0.5em 0.45em 0 0em var(--dot_1),-0.7em 0em 0 0em var(--dot_4),\n        -0.5em -0.45em 0 0em var(--dot_4);\n    }\n    75% {\n      box-shadow: 0em -0.7em 0em 0em var(--dot_4), 0.5em -0.45em 0 0em var(--dot_4), 0.7em 0em 0 0em var(--dot_4),\n        0.5em 0.45em 0 0em var(--dot_4), 0em 0.7em 0 0em var(--dot_3),\n        -0.5em 0.45em 0 0em var(--dot_2),-0.7em 0em 0 0em var(--dot_1),\n        -0.5em -0.45em 0 0em var(--dot_4);\n    }\n    87.5% {\n      box-shadow: 0em -0.7em 0em 0em var(--dot_4), 0.5em -0.45em 0 0em var(--dot_4), 0.7em 0em 0 0em var(--dot_4),\n        0.5em 0.45em 0 0em var(--dot_4), 0em 0.7em 0 0em var(--dot_4),\n        -0.5em 0.45em 0 0em var(--dot_3),-0.7em 0em 0 0em var(--dot_2),\n        -0.5em -0.45em 0 0em var(--dot_1);\n    }\n  `;\n}"],"names":["d3.select","d3\n    .select","d3.tsv","d3.csv"],"mappings":"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KAAK,EAAE,CAAC;AACvB,GAAG,EAAE,OAAO,CAAC,CAAC;AACd;AACA,EAAE,IAAI;AACN,IAAI,IAAI,WAAW,EAAE;AACrB,MAAM,eAAe,CAAC,WAAW,CAAC,CAAC;AACnC,KAAK;AACL,IAAI,IAAI,GAAG,MAAM,MAAM,CAAC,GAAG,EAAE,WAAW,CAAC,CAAC;AAC1C;AACA,IAAI,KAAK,GAAG,IAAI,CAAC;AACjB,IAAI,QAAQ,GAAG,SAAS,CAAC;AACzB,GAAG,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,IAAI,WAAW,EAAE;AACrB,MAAM,MAAM,MAAM;AAClB,QAAQ,KAAK,CAAC,IAAI,KAAK,YAAY;AACnC,YAAY,2BAA2B;AACvC,YAAY,KAAK,CAAC,QAAQ,EAAE,CAAC;AAC7B;AACA,MAAM,eAAe,CAAC,WAAW,EAAE,MAAM,CAAC,CAAC;AAC3C,KAAK;AACL;AACA,IAAI,MAAM,KAAK,CAAC;AAChB,GAAG,SAAS;AACZ,IAAI,IAAI,WAAW,EAAE;AACrB,MAAM,eAAe,CAAC,WAAW,CAAC,CAAC;AACnC,KAAK;AACL,IAAI,YAAY,CAAC,KAAK,CAAC,CAAC;AACxB,GAAG;AACH;AACA,EAAE,OAAO,IAAI,CAAC;AACd,CAAC;AACD;AACA,SAAS,aAAa,CAAC,KAAK,EAAE;AAC9B,EAAE,OAAO,CAAC;AACV;AACA,kCAAkC,EAAE,KAAK,CAAC;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,CAAC,CAAC;AACJ;;;;"}