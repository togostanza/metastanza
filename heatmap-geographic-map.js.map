{"version":3,"file":"heatmap-geographic-map.js","sources":["../../../home/runner/work/metastanza/metastanza/stanzas/heatmap-geographic-map/index.js"],"sourcesContent":["import Stanza from \"togostanza/stanza\";\nimport vegaEmbed from \"vega-embed\";\n\nexport default class heatmapGeographicMap extends Stanza {\n  async render() {\n    const spec = await fetch(\n      \"https://vega.github.io/vega/examples/annual-precipitation.vg.json\"\n    ).then((res) => res.json());\n\n    spec.width = this.params[\"width\"]; //metadata.jsにパラメータを定義\n    spec.height = this.params[\"height\"];\n\n    spec.data = [\n      {\n        name: \"precipitation\",\n        url: \"https://vega.github.io/vega/data/annual-precip.json\", //一時的にVegaのデータを使用\n      },\n      {\n        name: \"contours\",\n        source: \"precipitation\",\n        transform: [\n          {\n            type: \"isocontour\",\n            thresholds: { signal: \"sequence(step, stop, step)\" },\n          },\n        ],\n      },\n      {\n        name: \"world\",\n        url: \"https://vega.github.io/vega/data/world-110m.json\", //一時的にVegaのデータを使用\n        format: { type: \"topojson\", feature: \"countries\" },\n      },\n    ];\n\n    spec.projections = [\n      {\n        name: \"projection\",\n        type: { signal: \"projection\" },\n        scale: { signal: \"scale\" },\n        rotate: { signal: \"[rotate0, rotate1, rotate2]\" },\n        translate: { signal: \"[width/2, height/2]\" },\n      },\n    ];\n\n    (spec.scales = [\n      {\n        name: \"color\",\n        type: \"quantize\",\n        domain: { signal: \"[0, stop]\" },\n        range: { scheme: \"bluepurple\", count: { signal: \"levels\" } },\n      },\n    ]),\n      (spec.marks = [\n        {\n          type: \"shape\",\n          clip: true,\n          from: { data: \"world\" },\n          encode: {\n            update: {\n              strokeWidth: { value: 1 },\n              stroke: { value: \"var(--togostanza-map-border-color)\" },\n              fill: { value: \"var(--togostanza-map-color)\" },\n            },\n          },\n          transform: [\n            {\n              type: \"geoshape\",\n              projection: \"projection\",\n            },\n          ],\n        },\n        {\n          type: \"shape\",\n          clip: true,\n          from: { data: \"contours\" },\n          encode: {\n            update: {\n              fill: { scale: \"color\", field: \"contour.value\" },\n              fillOpacity: { signal: \"opacity\" },\n            },\n          },\n          transform: [\n            {\n              type: \"geoshape\",\n              field: \"datum.contour\",\n              projection: \"projection\",\n            },\n          ],\n        },\n      ]);\n\n    spec.legends = [\n      {\n        title: \"Annual Precipitation (mm)\",\n        fill: \"color\",\n        orient: \"bottom\",\n        offset: 5,\n        type: \"gradient\",\n        gradientLength: 300,\n        gradientThickness: 12,\n        titlePadding: 10,\n        titleOrient: \"left\",\n        titleAnchor: \"end\",\n        direction: \"horizontal\",\n      },\n    ];\n\n    const el = this.root.querySelector(\"main\");\n    const opts = {\n      renderer: \"svg\",\n    };\n    await vegaEmbed(el, spec, opts);\n  }\n}\n"],"names":["vegaEmbed"],"mappings":"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"}